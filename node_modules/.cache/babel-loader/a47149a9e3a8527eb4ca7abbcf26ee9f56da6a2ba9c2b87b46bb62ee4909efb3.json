{"ast":null,"code":"//do not need vuelidate, default method is set in setup when needed\n\nimport BaseMoney from 'presentation/components/BaseMoney/BaseMoney.vue';\nimport { ref, shallowRef, watch } from 'vue';\nimport useShippingMethods from 'hooks/useShippingMethods';\nimport useCartTools from 'hooks/useCartTools';\nexport default {\n  props: {\n    cart: {\n      type: Object,\n      required: true\n    }\n  },\n  components: {\n    BaseMoney\n  },\n  setup(props) {\n    const {\n      total,\n      loading,\n      error,\n      shippingMethods\n    } = useShippingMethods(props.cart.cartId);\n    const selectedShippingMethod = ref(props.cart?.shippingInfo?.shippingMethod?.methodId);\n    const cartTools = useCartTools();\n    watch(selectedShippingMethod, methodId => {\n      if (!methodId) {\n        return;\n      }\n      cartTools.setShippingMethod(methodId);\n    });\n    watch(shippingMethods, shippingMethods => {\n      if (!props.cart?.shippingInfo?.shippingMethod?.methodId && Boolean(shippingMethods?.length)) {\n        selectedShippingMethod.value = (shippingMethods.find(({\n          isDefault\n        }) => isDefault) || shippingMethods[0]).methodId;\n      }\n    });\n    const setSelectedShippingMethod = method => {\n      selectedShippingMethod.value = method;\n    };\n    const price = shippingMethod => {\n      //zone rates not for this country will be filtered out by graphql\n      //  shipping rates, not sure\n      const rate = shippingMethod?.zoneRates?.flatMap(({\n        shippingRates\n      }) => shippingRates).find(({\n        isMatching\n      }) => isMatching);\n      return props.cart.totalPrice.centAmount > (rate?.freeAbove?.centAmount || Infinity) ? null : rate?.price;\n    };\n    const method = shallowRef(selectedShippingMethod);\n    watch(method, method => {\n      setSelectedShippingMethod(method);\n    });\n    return {\n      method,\n      total,\n      loading,\n      error,\n      shippingMethods,\n      price,\n      selectedShippingMethod,\n      setSelectedShippingMethod\n    };\n  }\n};","map":{"version":3,"names":["BaseMoney","ref","shallowRef","watch","useShippingMethods","useCartTools","props","cart","type","Object","required","components","setup","total","loading","error","shippingMethods","cartId","selectedShippingMethod","shippingInfo","shippingMethod","methodId","cartTools","setShippingMethod","Boolean","length","value","find","isDefault","setSelectedShippingMethod","method","price","rate","zoneRates","flatMap","shippingRates","isMatching","totalPrice","centAmount","freeAbove","Infinity"],"sources":["/Users/souvitroy/Downloads/commercetools/ctools/src/presentation/fashion/PageCheckout/OrderOverview/ShippingMethod/ShippingMethod.js"],"sourcesContent":["//do not need vuelidate, default method is set in setup when needed\r\n\r\nimport BaseMoney from 'presentation/components/BaseMoney/BaseMoney.vue';\r\nimport { ref, shallowRef, watch } from 'vue';\r\nimport useShippingMethods from 'hooks/useShippingMethods';\r\nimport useCartTools from 'hooks/useCartTools';\r\nexport default {\r\n  props: {\r\n    cart: {\r\n      type: Object,\r\n      required: true,\r\n    },\r\n  },\r\n  components: {\r\n    BaseMoney,\r\n  },\r\n  setup(props) {\r\n    const { total, loading, error, shippingMethods } =\r\n      useShippingMethods(props.cart.cartId);\r\n    const selectedShippingMethod = ref(\r\n      props.cart?.shippingInfo?.shippingMethod?.methodId\r\n    );\r\n    const cartTools = useCartTools();\r\n    watch(selectedShippingMethod, (methodId) => {\r\n      if (!methodId) {\r\n        return;\r\n      }\r\n      cartTools.setShippingMethod(methodId);\r\n    });\r\n    watch(shippingMethods, (shippingMethods) => {\r\n      if (\r\n        !props.cart?.shippingInfo?.shippingMethod\r\n          ?.methodId &&\r\n        Boolean(shippingMethods?.length)\r\n      ) {\r\n        selectedShippingMethod.value = (\r\n          shippingMethods.find(\r\n            ({ isDefault }) => isDefault\r\n          ) || shippingMethods[0]\r\n        ).methodId;\r\n      }\r\n    });\r\n    const setSelectedShippingMethod = (method) => {\r\n      selectedShippingMethod.value = method;\r\n    };\r\n    const price = (shippingMethod) => {\r\n      //zone rates not for this country will be filtered out by graphql\r\n      //  shipping rates, not sure\r\n      const rate = shippingMethod?.zoneRates\r\n        ?.flatMap(({ shippingRates }) => shippingRates)\r\n        .find(({ isMatching }) => isMatching);\r\n      return props.cart.totalPrice.centAmount >\r\n        (rate?.freeAbove?.centAmount || Infinity)\r\n        ? null\r\n        : rate?.price;\r\n    };\r\n\r\n    const method = shallowRef(selectedShippingMethod);\r\n    watch(method, (method) => {\r\n      setSelectedShippingMethod(method);\r\n    });\r\n    return {\r\n      method,\r\n      total,\r\n      loading,\r\n      error,\r\n      shippingMethods,\r\n      price,\r\n      selectedShippingMethod,\r\n      setSelectedShippingMethod,\r\n    };\r\n  },\r\n};\r\n"],"mappings":"AAAA;;AAEA,OAAOA,SAAS,MAAM,iDAAiD;AACvE,SAASC,GAAG,EAAEC,UAAU,EAAEC,KAAK,QAAQ,KAAK;AAC5C,OAAOC,kBAAkB,MAAM,0BAA0B;AACzD,OAAOC,YAAY,MAAM,oBAAoB;AAC7C,eAAe;EACbC,KAAK,EAAE;IACLC,IAAI,EAAE;MACJC,IAAI,EAAEC,MAAM;MACZC,QAAQ,EAAE;IACZ;EACF,CAAC;EACDC,UAAU,EAAE;IACVX;EACF,CAAC;EACDY,KAAK,CAACN,KAAK,EAAE;IACX,MAAM;MAAEO,KAAK;MAAEC,OAAO;MAAEC,KAAK;MAAEC;IAAgB,CAAC,GAC9CZ,kBAAkB,CAACE,KAAK,CAACC,IAAI,CAACU,MAAM,CAAC;IACvC,MAAMC,sBAAsB,GAAGjB,GAAG,CAChCK,KAAK,CAACC,IAAI,EAAEY,YAAY,EAAEC,cAAc,EAAEC,QAAQ,CACnD;IACD,MAAMC,SAAS,GAAGjB,YAAY,EAAE;IAChCF,KAAK,CAACe,sBAAsB,EAAGG,QAAQ,IAAK;MAC1C,IAAI,CAACA,QAAQ,EAAE;QACb;MACF;MACAC,SAAS,CAACC,iBAAiB,CAACF,QAAQ,CAAC;IACvC,CAAC,CAAC;IACFlB,KAAK,CAACa,eAAe,EAAGA,eAAe,IAAK;MAC1C,IACE,CAACV,KAAK,CAACC,IAAI,EAAEY,YAAY,EAAEC,cAAc,EACrCC,QAAQ,IACZG,OAAO,CAACR,eAAe,EAAES,MAAM,CAAC,EAChC;QACAP,sBAAsB,CAACQ,KAAK,GAAG,CAC7BV,eAAe,CAACW,IAAI,CAClB,CAAC;UAAEC;QAAU,CAAC,KAAKA,SAAS,CAC7B,IAAIZ,eAAe,CAAC,CAAC,CAAC,EACvBK,QAAQ;MACZ;IACF,CAAC,CAAC;IACF,MAAMQ,yBAAyB,GAAIC,MAAM,IAAK;MAC5CZ,sBAAsB,CAACQ,KAAK,GAAGI,MAAM;IACvC,CAAC;IACD,MAAMC,KAAK,GAAIX,cAAc,IAAK;MAChC;MACA;MACA,MAAMY,IAAI,GAAGZ,cAAc,EAAEa,SAAS,EAClCC,OAAO,CAAC,CAAC;QAAEC;MAAc,CAAC,KAAKA,aAAa,CAAC,CAC9CR,IAAI,CAAC,CAAC;QAAES;MAAW,CAAC,KAAKA,UAAU,CAAC;MACvC,OAAO9B,KAAK,CAACC,IAAI,CAAC8B,UAAU,CAACC,UAAU,IACpCN,IAAI,EAAEO,SAAS,EAAED,UAAU,IAAIE,QAAQ,CAAC,GACvC,IAAI,GACJR,IAAI,EAAED,KAAK;IACjB,CAAC;IAED,MAAMD,MAAM,GAAG5B,UAAU,CAACgB,sBAAsB,CAAC;IACjDf,KAAK,CAAC2B,MAAM,EAAGA,MAAM,IAAK;MACxBD,yBAAyB,CAACC,MAAM,CAAC;IACnC,CAAC,CAAC;IACF,OAAO;MACLA,MAAM;MACNjB,KAAK;MACLC,OAAO;MACPC,KAAK;MACLC,eAAe;MACfe,KAAK;MACLb,sBAAsB;MACtBW;IACF,CAAC;EACH;AACF,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}