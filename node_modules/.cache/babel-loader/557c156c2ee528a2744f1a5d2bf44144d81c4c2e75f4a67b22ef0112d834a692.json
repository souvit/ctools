{"ast":null,"code":"//@todo: put some of this code in a hook\nimport useLocale from 'hooks/useLocale';\nimport { shallowRef } from 'vue';\nimport { useI18n } from 'vue-i18n';\nimport translations from \"./VariantSelector.json\";\nimport { useRoute, useRouter } from 'vue-router';\nimport config from '../../../../../../sunrise.config';\nimport { getAttributeValue } from 'containers/lib';\nimport { move } from '../../../../../lib';\nexport default {\n  props: {\n    allVariants: {\n      type: Array,\n      required: true\n    },\n    sku: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    const {\n      t\n    } = useI18n({\n      messages: translations\n    });\n    const route = useRoute();\n    const router = useRouter();\n    const {\n      locale\n    } = useLocale();\n    const tmpAttributes = props.allVariants.map(({\n      attributesRaw,\n      sku\n    }) => attributesRaw.map(({\n      name,\n      value\n    }) => {\n      return {\n        label: name,\n        //@todo: how to translate name??\n        value: getAttributeValue(value, locale.value),\n        sku,\n        score: props.sku === sku ? 1 : 0\n      };\n    })).flat().filter(({\n      label\n    }) => config.variantSelector.includes(label));\n    const variants = shallowRef((() => {\n      const variants = tmpAttributes.reduce((acc, {\n        label,\n        value\n      }) => acc.set(label, (acc.get(label) || []).concat(value)), new Map());\n      variants.forEach((value, key) => {\n        if (new Set(value).size <= 1) {\n          variants.delete(key);\n        } else {\n          variants.set(key, [...new Set(value)]);\n        }\n      });\n      return variants;\n    })());\n    const validKeys = [...variants.value.keys()];\n    const score = shallowRef(tmpAttributes.filter(({\n      label\n    }) => validKeys.includes(label)).reduce((acc, {\n      label,\n      value,\n      score,\n      sku\n    }) => acc.set(sku, {\n      ...acc.get(sku),\n      score: (acc.get(sku)?.score || 0) + score,\n      [label]: value\n    }), new Map()));\n    const userSet = shallowRef({});\n    const setScore = (label, value) => {\n      const previousScore = v => {\n        const pref = score.value.get(props.sku);\n        return Object.keys(pref).filter(key => key !== 'score').reduce((acc, item) => v[item] === pref[item] ? acc + 1 : acc, 0);\n      };\n      //vue does not understand immutable\n      // eslint-disable-next-line no-unused-vars\n      const {\n        [label]: _,\n        ...rest\n      } = userSet.value;\n      userSet.value = {\n        ...rest,\n        [label]: value\n      };\n      const newScore = new Map(score.value);\n      newScore.forEach((v, sku) => {\n        const newV = {\n          ...v\n        };\n        newV.score = String(v[label]) === value ? 100 : v[label] === userSet.value[label] ? 20 : 0;\n        newV.score = newV.score + previousScore(v);\n        newScore.set(sku, newV);\n      });\n      score.value = newScore;\n    };\n    const setVariant = () => {\n      let high = 0;\n      let sku;\n      score.value.forEach(({\n        score\n      }, key) => {\n        if (score >= high) {\n          high = score;\n          sku = key;\n        }\n      });\n      move(router, route, {\n        ...route.params,\n        sku\n      }, 'push');\n    };\n    const variantChange = (label, e) => {\n      setScore(label, e.target.value);\n    };\n    const changeAndSet = (label, e) => {\n      variantChange(label, e);\n      setVariant();\n    };\n    const isSelected = (label, value) => score.value.get(props.sku)[label] === value;\n    return {\n      variants,\n      variantChange,\n      isSelected,\n      setVariant,\n      changeAndSet,\n      t\n    };\n  }\n};","map":{"version":3,"names":["useLocale","shallowRef","useI18n","translations","useRoute","useRouter","config","getAttributeValue","move","props","allVariants","type","Array","required","sku","String","setup","t","messages","route","router","locale","tmpAttributes","map","attributesRaw","name","value","label","score","flat","filter","variantSelector","includes","variants","reduce","acc","set","get","concat","Map","forEach","key","Set","size","delete","validKeys","keys","userSet","setScore","previousScore","v","pref","Object","item","_","rest","newScore","newV","setVariant","high","params","variantChange","e","target","changeAndSet","isSelected"],"sources":["/Users/souvitroy/Downloads/commercetools/ctools/src/presentation/fashion/PageProductDetail/ProductInfo/VariantSelector/VariantSelector.js"],"sourcesContent":["//@todo: put some of this code in a hook\r\nimport useLocale from 'hooks/useLocale';\r\nimport { shallowRef } from 'vue';\r\nimport { useI18n } from 'vue-i18n';\r\nimport translations from \"./VariantSelector.json\"\r\nimport { useRoute, useRouter } from 'vue-router';\r\nimport config from '../../../../../../sunrise.config';\r\nimport { getAttributeValue } from 'containers/lib';\r\nimport { move } from '../../../../../lib';\r\n\r\nexport default {\r\n  props: {\r\n    allVariants: {\r\n      type: Array,\r\n      required: true,\r\n    },\r\n    sku: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n  },\r\n  setup(props) {\r\n    const { t } = useI18n({\r\n      messages: translations\r\n    });\r\n    const route = useRoute();\r\n    const router = useRouter();\r\n    const { locale } = useLocale();\r\n    const tmpAttributes = props.allVariants\r\n      .map(({ attributesRaw, sku }) =>\r\n        attributesRaw.map(({ name, value }) => {\r\n          return {\r\n            label: name, //@todo: how to translate name??\r\n            value: getAttributeValue(value, locale.value),\r\n            sku,\r\n            score: props.sku === sku ? 1 : 0,\r\n          };\r\n        })\r\n      )\r\n      .flat()\r\n      .filter(({ label }) =>\r\n        config.variantSelector.includes(label)\r\n      );\r\n    const variants = shallowRef(\r\n      (() => {\r\n        const variants = tmpAttributes.reduce(\r\n          (acc, { label, value }) =>\r\n            acc.set(\r\n              label,\r\n              (acc.get(label) || []).concat(value)\r\n            ),\r\n          new Map()\r\n        );\r\n        variants.forEach((value, key) => {\r\n          if (new Set(value).size <= 1) {\r\n            variants.delete(key);\r\n          } else {\r\n            variants.set(key, [...new Set(value)]);\r\n          }\r\n        });\r\n        return variants;\r\n      })()\r\n    );\r\n    const validKeys = [...variants.value.keys()];\r\n    const score = shallowRef(\r\n      tmpAttributes\r\n        .filter(({ label }) => validKeys.includes(label))\r\n        .reduce(\r\n          (acc, { label, value, score, sku }) =>\r\n            acc.set(sku, {\r\n              ...acc.get(sku),\r\n              score: (acc.get(sku)?.score || 0) + score,\r\n              [label]: value,\r\n            }),\r\n          new Map()\r\n        )\r\n    );\r\n    const userSet = shallowRef({});\r\n    const setScore = (label, value) => {\r\n      const previousScore = (v) => {\r\n        const pref = score.value.get(props.sku);\r\n        return Object.keys(pref)\r\n          .filter((key) => key !== 'score')\r\n          .reduce(\r\n            (acc, item) =>\r\n              v[item] === pref[item] ? acc + 1 : acc,\r\n            0\r\n          );\r\n      };\r\n      //vue does not understand immutable\r\n      // eslint-disable-next-line no-unused-vars\r\n      const { [label]: _, ...rest } = userSet.value;\r\n      userSet.value = { ...rest, [label]: value };\r\n      const newScore = new Map(score.value);\r\n      newScore.forEach((v, sku) => {\r\n        const newV = { ...v };\r\n        newV.score =\r\n          String(v[label]) === value\r\n            ? 100\r\n            : v[label] === userSet.value[label]\r\n              ? 20\r\n              : 0;\r\n        newV.score = newV.score + previousScore(v);\r\n        newScore.set(sku, newV);\r\n      });\r\n      score.value = newScore;\r\n    };\r\n    const setVariant = () => {\r\n      let high = 0;\r\n      let sku;\r\n      score.value.forEach(({ score }, key) => {\r\n        if (score >= high) {\r\n          high = score;\r\n          sku = key;\r\n        }\r\n      });\r\n      move(router, route, { ...route.params, sku }, 'push');\r\n    };\r\n    const variantChange = (label, e) => {\r\n      setScore(label, e.target.value);\r\n    };\r\n    const changeAndSet = (label, e) => {\r\n      variantChange(label, e);\r\n      setVariant();\r\n    };\r\n    const isSelected = (label, value) =>\r\n      score.value.get(props.sku)[label] === value;\r\n    return {\r\n      variants,\r\n      variantChange,\r\n      isSelected,\r\n      setVariant,\r\n      changeAndSet,\r\n      t,\r\n    };\r\n  },\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}