{"ast":null,"code":"import { onMounted, onUnmounted, shallowRef } from 'vue';\nimport { cache } from '../src/apollo';\nimport { CHANNEL } from '../src/constants';\nimport { createReactive } from './lib';\nimport addVisibilityChangeListener from './lib';\naddVisibilityChangeListener((value => status => {\n  const currentValue = localStorage.getItem(CHANNEL);\n  if (status) {\n    //tab/window became visible see if item changed\n    if (currentValue !== value) {\n      //item changed in other tab or window, reset\n      //  cache and reload from local storage\n      value = currentValue;\n      cache.reset();\n      cache.gc();\n      channelGlobal.setValue(JSON.parse(localStorage.getItem(CHANNEL)));\n    }\n  }\n  value = currentValue;\n})(localStorage.getItem(CHANNEL)));\nconst channelGlobal = createReactive(JSON.parse(localStorage.getItem(CHANNEL)), newValue => localStorage.setItem(CHANNEL, JSON.stringify(newValue)));\nfunction useSelectedChannel() {\n  const channel = shallowRef(channelGlobal.ref.value);\n  const setChannel = channel => channelGlobal.setValue(channel);\n  const unListen = {\n    fn: () => 88\n  };\n  onMounted(() => {\n    unListen.fn = channelGlobal.addListener(newValue => {\n      channel.value = newValue;\n    });\n  });\n  onUnmounted(() => unListen.fn());\n  return {\n    channel,\n    setChannel\n  };\n}\nexport default useSelectedChannel;","map":{"version":3,"names":["onMounted","onUnmounted","shallowRef","cache","CHANNEL","createReactive","addVisibilityChangeListener","value","status","currentValue","localStorage","getItem","reset","gc","channelGlobal","setValue","JSON","parse","newValue","setItem","stringify","useSelectedChannel","channel","ref","setChannel","unListen","fn","addListener"],"sources":["/Users/souvitroy/Downloads/commercetools/ctools/composition/useSelectedChannel.js"],"sourcesContent":["import { onMounted, onUnmounted, shallowRef } from 'vue';\r\nimport { cache } from '../src/apollo';\r\nimport { CHANNEL } from '../src/constants';\r\nimport { createReactive } from './lib';\r\nimport addVisibilityChangeListener from './lib';\r\n\r\naddVisibilityChangeListener(\r\n  ((value) => (status) => {\r\n    const currentValue = localStorage.getItem(CHANNEL);\r\n    if (status) {\r\n      //tab/window became visible see if item changed\r\n      if (currentValue !== value) {\r\n        //item changed in other tab or window, reset\r\n        //  cache and reload from local storage\r\n        value = currentValue;\r\n        cache.reset();\r\n        cache.gc();\r\n        channelGlobal.setValue(\r\n          JSON.parse(localStorage.getItem(CHANNEL))\r\n        );\r\n      }\r\n    }\r\n\r\n    value = currentValue;\r\n  })(localStorage.getItem(CHANNEL))\r\n);\r\nconst channelGlobal = createReactive(\r\n  JSON.parse(localStorage.getItem(CHANNEL)),\r\n  (newValue) =>\r\n    localStorage.setItem(CHANNEL, JSON.stringify(newValue))\r\n);\r\n\r\nfunction useSelectedChannel() {\r\n  const channel = shallowRef(channelGlobal.ref.value);\r\n  const setChannel = (channel) =>\r\n    channelGlobal.setValue(channel);\r\n  const unListen = { fn: () => 88 };\r\n  onMounted(() => {\r\n    unListen.fn = channelGlobal.addListener((newValue) => {\r\n      channel.value = newValue;\r\n    });\r\n  });\r\n  onUnmounted(() => unListen.fn());\r\n\r\n  return {\r\n    channel,\r\n    setChannel,\r\n  };\r\n}\r\nexport default useSelectedChannel;\r\n"],"mappings":"AAAA,SAASA,SAAS,EAAEC,WAAW,EAAEC,UAAU,QAAQ,KAAK;AACxD,SAASC,KAAK,QAAQ,eAAe;AACrC,SAASC,OAAO,QAAQ,kBAAkB;AAC1C,SAASC,cAAc,QAAQ,OAAO;AACtC,OAAOC,2BAA2B,MAAM,OAAO;AAE/CA,2BAA2B,CACzB,CAAEC,KAAK,IAAMC,MAAM,IAAK;EACtB,MAAMC,YAAY,GAAGC,YAAY,CAACC,OAAO,CAACP,OAAO,CAAC;EAClD,IAAII,MAAM,EAAE;IACV;IACA,IAAIC,YAAY,KAAKF,KAAK,EAAE;MAC1B;MACA;MACAA,KAAK,GAAGE,YAAY;MACpBN,KAAK,CAACS,KAAK,EAAE;MACbT,KAAK,CAACU,EAAE,EAAE;MACVC,aAAa,CAACC,QAAQ,CACpBC,IAAI,CAACC,KAAK,CAACP,YAAY,CAACC,OAAO,CAACP,OAAO,CAAC,CAAC,CAC1C;IACH;EACF;EAEAG,KAAK,GAAGE,YAAY;AACtB,CAAC,EAAEC,YAAY,CAACC,OAAO,CAACP,OAAO,CAAC,CAAC,CAClC;AACD,MAAMU,aAAa,GAAGT,cAAc,CAClCW,IAAI,CAACC,KAAK,CAACP,YAAY,CAACC,OAAO,CAACP,OAAO,CAAC,CAAC,EACxCc,QAAQ,IACPR,YAAY,CAACS,OAAO,CAACf,OAAO,EAAEY,IAAI,CAACI,SAAS,CAACF,QAAQ,CAAC,CAAC,CAC1D;AAED,SAASG,kBAAkB,GAAG;EAC5B,MAAMC,OAAO,GAAGpB,UAAU,CAACY,aAAa,CAACS,GAAG,CAAChB,KAAK,CAAC;EACnD,MAAMiB,UAAU,GAAIF,OAAO,IACzBR,aAAa,CAACC,QAAQ,CAACO,OAAO,CAAC;EACjC,MAAMG,QAAQ,GAAG;IAAEC,EAAE,EAAE,MAAM;EAAG,CAAC;EACjC1B,SAAS,CAAC,MAAM;IACdyB,QAAQ,CAACC,EAAE,GAAGZ,aAAa,CAACa,WAAW,CAAET,QAAQ,IAAK;MACpDI,OAAO,CAACf,KAAK,GAAGW,QAAQ;IAC1B,CAAC,CAAC;EACJ,CAAC,CAAC;EACFjB,WAAW,CAAC,MAAMwB,QAAQ,CAACC,EAAE,EAAE,CAAC;EAEhC,OAAO;IACLJ,OAAO;IACPE;EACF,CAAC;AACH;AACA,eAAeH,kBAAkB"},"metadata":{},"sourceType":"module","externalDependencies":[]}